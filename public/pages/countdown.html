<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live Event Countdown</title>
  <style>
    :root{
      --bg-dark: #0b0d10;
      --fg: #e9eef5;
      --muted: #9aa4b2;
      --accent: #60a5fa;
      --glass: rgba(15,18,22,.5);
      --glass-strong: rgba(15,18,22,.75);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--fg); background: var(--bg-dark); overflow-x:hidden;
    }

    /* Background + Parallax */
    .bg-wrap{
      position:fixed; inset:0; overflow:hidden; z-index:-1;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(96,165,250,.25), transparent 60%),
                  radial-gradient(800px 600px at 80% 80%, rgba(96,250,212,.18), transparent 60%),
                  #090b10;
    }
    .bg-img{
      position:absolute; inset:-10% -10%; background-position:center; background-size:cover; filter:brightness(.8) saturate(.9);
      transform: scale(1.05);
      transition: opacity .5s ease;
      opacity:.35;
    }
    .bg-overlay{position:absolute; inset:0; backdrop-filter: blur(4px);}

    /* Layout */
    .container{max-width:1100px; margin:0 auto; padding: 24px;}
    header{
      display:flex; gap:18px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{font-weight:700; letter-spacing:.3px; opacity:.9}
    .panel{
      background:linear-gradient(180deg, var(--glass), var(--glass-strong));
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px; box-shadow:var(--shadow);
      padding:16px;
    }

    /* Form */
    form{display:grid; grid-template-columns:1fr 1fr; gap:14px;}
    .field{display:flex; flex-direction:column; gap:6px}
    label{font-size:.9rem; color:var(--muted)}
    input[type="text"], input[type="datetime-local"], input[type="file"]{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1);
      background: rgba(12,14,16,.7); color:var(--fg); outline:none; box-shadow:inset 0 0 0 1px transparent;
    }
    input[type="text"]:focus, input[type="datetime-local"]:focus{ box-shadow:inset 0 0 0 1px var(--accent);}

    .actions{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
    button, .btn{
      appearance:none; border:none; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:600;
      background:var(--accent); color:#071018; box-shadow:0 8px 24px rgba(96,165,250,.35);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    button:hover, .btn:hover{ transform: translateY(-1px); }
    .btn-secondary{ background: transparent; color:var(--fg); border:1px solid rgba(255,255,255,.18); box-shadow:none; }

    /* Countdown */
    .hero{
      display:grid; grid-template-columns:1.2fr .8fr; gap:24px; align-items:stretch; margin-top:18px;
    }
    .event-card{ padding:22px; display:flex; flex-direction:column; gap:18px;}
    .event-title{font-size:clamp(24px, 3vw, 36px); font-weight:800; line-height:1.1;}
    .event-meta{ color:var(--muted); font-size:1rem;}

    .countdown{
      display:flex; align-items:stretch; justify-content:space-between; gap:14px;
    }
    .slot{
      flex:1; text-align:center; background:rgba(255,255,255,.04); border-radius:16px; padding:16px 12px; border:1px solid rgba(255,255,255,.08);
    }
    .label{ font-size:.85rem; color:var(--muted); letter-spacing:.08em; text-transform:uppercase; }

    .digits{ display:flex; justify-content:center; gap:8px; margin:8px 0 6px 0 }
    .digit{
      display:inline-flex; align-items:center; justify-content:center;
      width: clamp(44px, 6vw, 70px); height: clamp(56px, 7.8vw, 96px);
      font-weight:800; font-variant-numeric: tabular-nums; font-size: clamp(28px, 6.2vw, 64px);
      border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow: inset 0 -3px 10px rgba(0,0,0,.35), 0 10px 24px rgba(0,0,0,.25);
      position:relative; overflow:hidden;
    }
    .digit.pulse{ animation: pulse .45s ease; }
    @keyframes pulse{ 0%{ transform:scale(1)} 40%{ transform:scale(1.08)} 100%{ transform:scale(1)} }

    .colon{ display:flex; align-items:center; font-size: clamp(28px, 5vw, 48px); opacity:.6; padding:0 4px;}

    .calendar-row{display:flex; gap:12px; flex-wrap:wrap}

    /* Footer */
    footer{ margin:26px auto; text-align:center; color:var(--muted); font-size:.9rem }

    /* Responsive */
    @media (max-width: 900px){ .hero{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="bg-wrap">
    <div id="bgImg" class="bg-img"></div>
    <div class="bg-overlay"></div>
  </div>

  <div class="container">
    <header>
      <div class="brand">⏳ Live Event Countdown</div>
      <div class="actions">
        <button id="shareBtn" title="Share event via link">Share</button>
        <button class="btn-secondary" id="resetBtn" title="Clear saved data">Reset</button>
      </div>
    </header>

    <div class="panel" style="margin-top:14px">
      <form id="eventForm">
        <div class="field">
          <label for="name">Event name</label>
          <input id="name" type="text" placeholder="e.g. Product Launch Night" required />
        </div>
        <div class="field">
          <label for="datetime">Date & time</label>
          <input id="datetime" type="datetime-local" required />
        </div>
        <div class="field">
          <label for="location">Location</label>
          <input id="location" type="text" placeholder="e.g. Denver, CO or Zoom link" />
        </div>
        <div class="field">
          <label for="bgInput">Background image</label>
          <input id="bgInput" type="file" accept="image/*" />
        </div>
        <div class="actions" style="grid-column:1/-1; justify-content:flex-end;">
          <button type="submit">Start / Update</button>
          <a id="icsBtn" class="btn" download="event.ics">Save to Calendar (.ics)</a>
          <a id="gcalBtn" class="btn-secondary" target="_blank" rel="noopener">Add to Google Calendar</a>
        </div>
      </form>
    </div>

    <div class="hero">
      <div class="panel event-card">
        <div class="event-title" id="titleOut">Name your event</div>
        <div class="event-meta">
          <div><strong>When:</strong> <span id="whenOut">—</span></div>
          <div><strong>Where:</strong> <span id="whereOut">—</span></div>
        </div>
        <div class="calendar-row">
          <a id="icsBtn2" class="btn" download="event.ics">Save to Calendar (.ics)</a>
          <a id="gcalBtn2" class="btn-secondary" target="_blank" rel="noopener">Add to Google Calendar</a>
        </div>
      </div>

      <div class="panel" aria-live="polite" aria-atomic="true">
        <div class="countdown" id="countdown">
          <!-- Slots will be injected by JS -->
        </div>
      </div>
    </div>

    <footer>Tip: everything saves locally in your browser. Share creates a URL with your event details.</footer>
  </div>

  <script>
    // ===== Utilities =====
    const qs = sel => document.querySelector(sel);
    const el = id => document.getElementById(id);
    const pad = n => String(n).padStart(2,'0');

    function formatWhen(dt){
      if(!dt) return '—';
      try{
        const d = new Date(dt);
        const opts = {weekday:'short', year:'numeric', month:'short', day:'numeric', hour:'numeric', minute:'2-digit'};
        return d.toLocaleString(undefined, opts);
      }catch{ return dt }
    }

    function toICS({title, startLocal, endLocal, location}){
      const uid = Math.random().toString(36).slice(2)+"@live-countdown";
      const dtStart = new Date(startLocal);
      const dtEnd = endLocal ? new Date(endLocal) : new Date(new Date(startLocal).getTime()+60*60*1000);
      const fmt = (d)=> d.toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z';
      const lines = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Live Event Countdown//EN','CALSCALE:GREGORIAN','METHOD:PUBLISH','BEGIN:VEVENT',
        `UID:${uid}`,`DTSTAMP:${fmt(new Date())}`,`DTSTART:${fmt(dtStart)}`,`DTEND:${fmt(dtEnd)}`,
        `SUMMARY:${(title||'My Event').replace(/\n/g,' ')}`,
        location?`LOCATION:${location.replace(/\n/g,' ')}`:null,
        'END:VEVENT','END:VCALENDAR'
      ].filter(Boolean).join('\r\n');
      return new Blob([lines], {type:'text/calendar'});
    }

    function gcalLink({title, startLocal, endLocal, location}){
      const d1 = new Date(startLocal);
      const d2 = endLocal ? new Date(endLocal) : new Date(d1.getTime()+60*60*1000);
      const fmt = d => d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
      const params = new URLSearchParams({ action:'TEMPLATE', text: title||'My Event', dates: `${fmt(d1)}/${fmt(d2)}`, location: location||'' });
      return 'https://calendar.google.com/calendar/render?'+params.toString();
    }

    function stateFromURL(){
      const p = new URLSearchParams(location.search);
      const s = {};
      if(p.get('t')) s.name = decodeURIComponent(p.get('t'));
      if(p.get('d')) s.datetime = decodeURIComponent(p.get('d'));
      if(p.get('l')) s.location = decodeURIComponent(p.get('l'));
      return s;
    }

    function updateShareURL(){
      const {value:name} = el('name');
      const {value:datetime} = el('datetime');
      const {value:locationTxt} = el('location');
      const params = new URLSearchParams();
      if(name) params.set('t', encodeURIComponent(name));
      if(datetime) params.set('d', encodeURIComponent(datetime));
      if(locationTxt) params.set('l', encodeURIComponent(locationTxt));
      const u = location.origin + location.pathname + (params.toString()? ('?'+params.toString()):'');
      navigator.clipboard?.writeText(u);
      alert('Shareable link copied to clipboard!\n\n'+u);
    }

    // ===== Parallax Background =====
    (function(){
      const bg = el('bgImg');
      let tx=0, ty=0, cx=0, cy=0; // target vs current
      function animate(){
        cx += (tx - cx) * 0.035;
        cy += (ty - cy) * 0.035;
        bg.style.transform = `translate(${cx}px, ${cy}px) scale(1.08)`;
        requestAnimationFrame(animate);
      }
      window.addEventListener('mousemove', (e)=>{
        const {innerWidth:w, innerHeight:h} = window;
        tx = (e.clientX - w/2) * -0.02;
        ty = (e.clientY - h/2) * -0.02;
      });
      animate();
    })();

    // ===== Countdown Renderer =====
    const countdownEl = el('countdown');
    const parts = ['Days','Hours','Minutes','Seconds'];
    const slots = {};

    function makeSlot(label){
      const wrap = document.createElement('div'); wrap.className = 'slot';
      const digits = document.createElement('div'); digits.className = 'digits';
      const caption = document.createElement('div'); caption.className = 'label'; caption.textContent = label;
      // three digits for days, two for others
      const n = label === 'Days' ? 3 : 2;
      const spans = Array.from({length:n}, ()=>{ const s=document.createElement('div'); s.className='digit'; s.textContent='0'; digits.appendChild(s); return s; });
      wrap.append(digits, caption);
      countdownEl.appendChild(wrap);
      return spans;
    }

    parts.forEach(p=> slots[p]=makeSlot(p));

    let targetTime = null; let timer; let lastValues = {Days:'', Hours:'', Minutes:'', Seconds:''};

    function updateCountdown(){
      if(!targetTime){ return; }
      const now = new Date();
      let delta = Math.max(0, targetTime - now);
      if(delta === 0){ clearInterval(timer); }
      const sec = Math.floor(delta/1000) % 60;
      const min = Math.floor(delta/60000) % 60;
      const hr  = Math.floor(delta/3600000) % 24;
      const days= Math.floor(delta/86400000);
      const vals = { Days: String(days).padStart(3,'0'), Hours: pad(hr), Minutes: pad(min), Seconds: pad(sec) };

      for(const key of parts){
        const arr = slots[key];
        const str = vals[key];
        if(str !== lastValues[key]){
          // animate each digit change
          str.split('').forEach((ch,i)=>{
            const d = arr[i];
            if(!d) return; // safety
            if(d.textContent !== ch){
              d.textContent = ch;
              d.classList.remove('pulse');
              // trigger reflow to restart animation
              void d.offsetWidth;
              d.classList.add('pulse');
            }
          });
          lastValues[key] = str;
        }
      }
    }

    function setTarget(dtStr){
      targetTime = dtStr ? new Date(dtStr) : null;
      if(timer) clearInterval(timer);
      if(targetTime){ timer = setInterval(updateCountdown, 1000); updateCountdown(); }
    }

    // ===== Form Binding & Persistence =====
    const form = el('eventForm');
    const titleOut = el('titleOut');
    const whenOut = el('whenOut');
    const whereOut = el('whereOut');

    function persist(){
      const data = {
        name: el('name').value,
        datetime: el('datetime').value,
        location: el('location').value,
        bg: sessionStorage.getItem('bgDataUrl') || null
      };
      localStorage.setItem('countdown:data', JSON.stringify(data));
    }

    function load(){
      const urlState = stateFromURL();
      const saved = JSON.parse(localStorage.getItem('countdown:data')||'{}');
      const data = { ...saved, ...urlState };
      if(data.name) el('name').value = data.name;
      if(data.datetime) el('datetime').value = data.datetime;
      if(data.location) el('location').value = data.location;
      if(saved.bg){ setBackground(saved.bg); }
      reflect();
    }

    function reflect(){
      const name = el('name').value.trim() || 'Your Next Big Thing';
      const dt = el('datetime').value;
      const loc = el('location').value.trim() || '—';
      titleOut.textContent = name;
      whenOut.textContent = formatWhen(dt);
      whereOut.textContent = loc;
      setTarget(dt);
      // calendar buttons
      const icsBlob = toICS({title:name, startLocal: dt, endLocal: null, location: loc});
      const icsUrl = URL.createObjectURL(icsBlob);
      el('icsBtn').href = icsUrl; el('icsBtn2').href = icsUrl;
      const gUrl = gcalLink({title:name, startLocal: dt, endLocal:null, location:loc});
      el('gcalBtn').href=gUrl; el('gcalBtn2').href=gUrl;
    }

    form.addEventListener('submit', (e)=>{ e.preventDefault(); reflect(); persist(); });
    ['name','datetime','location'].forEach(id=> el(id).addEventListener('input', ()=>{ reflect(); persist(); }));

    // Background image upload
    el('bgInput').addEventListener('change', async (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const url = reader.result;
        sessionStorage.setItem('bgDataUrl', url);
        setBackground(url);
        persist();
      };
      reader.readAsDataURL(file);
    });

    function setBackground(url){
      const bg = el('bgImg');
      bg.style.backgroundImage = `url('${url}')`;
      bg.style.opacity = 0.4;
    }

    // Share & Reset
    el('shareBtn').addEventListener('click', updateShareURL);
    el('resetBtn').addEventListener('click', ()=>{
      if(confirm('Clear saved event & background?')){
        localStorage.removeItem('countdown:data');
        sessionStorage.removeItem('bgDataUrl');
        el('name').value=''; el('datetime').value=''; el('location').value='';
        el('bgInput').value=''; el('bgImg').style.backgroundImage='';
        reflect();
      }
    });

    // Init with a pleasant default time ~ 7 days from now top of the hour if empty
    (function initDefault(){
      const dtInput = el('datetime');
      if(!dtInput.value){
        const d = new Date();
        d.setDate(d.getDate()+7); d.setMinutes(0,0,0);
        dtInput.value = new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,16);
      }
    })();

    load();
  </script>
</body>
</html>
